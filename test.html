<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 聊天机器人 - 本地测试</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>🤖 AI 助手（测试模式）</h1>
            <p>本地测试界面 - 不连接真实 API</p>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="message bot-message">
                <div class="message-content">
                    你好！这是本地测试模式。你可以在这里测试界面效果，但不会真正调用 API。
                </div>
            </div>
        </div>

        <div class="chat-input-container">
            <textarea
                id="userInput"
                class="chat-input"
                placeholder="输入你的问题..."
                rows="1"
            ></textarea>
            <button id="sendButton" class="send-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                </svg>
            </button>
        </div>

        <div class="loading-indicator" id="loadingIndicator">
            <div class="typing-indicator">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </div>

    <script>
        // 本地测试脚本
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const loadingIndicator = document.getElementById('loadingIndicator');

        sendButton.addEventListener('click', sendMessage);

        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        userInput.addEventListener('input', () => {
            userInput.style.height = 'auto';
            userInput.style.height = Math.min(userInput.scrollHeight, 150) + 'px';
        });

        function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            addMessage(message, 'user');
            userInput.value = '';
            userInput.style.height = 'auto';

            loadingIndicator.style.display = 'flex';

            // 模拟 API 响应
            setTimeout(() => {
                loadingIndicator.style.display = 'none';
                simulateStreamingResponse();
            }, 1000);
        }

        function simulateStreamingResponse() {
            const responses = [
                '这是一个测试响应。在实际部署后，这里会显示 AI 的真实回复。',
                '界面看起来不错！继续配置 Cloudflare Worker 来启用真实的 AI 功能。',
                '测试成功！你可以看到消息以流式方式显示，就像真实的 AI 回复一样。'
            ];

            const response = responses[Math.floor(Math.random() * responses.length)];
            const messageElement = addMessage('', 'bot');
            const contentElement = messageElement.querySelector('.message-content');

            let index = 0;
            const interval = setInterval(() => {
                if (index < response.length) {
                    contentElement.textContent += response[index];
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    index++;
                } else {
                    clearInterval(interval);
                }
            }, 30);
        }

        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = text;

            messageDiv.appendChild(contentDiv);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            return messageDiv;
        }
    </script>
</body>
</html>

